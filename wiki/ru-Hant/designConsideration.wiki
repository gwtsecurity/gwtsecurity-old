#summary Design guide

= Введение =
[http://static.springsource.org/spring-security/site/ Spring Security ] всегда требуется аутентификация, в тех случаях когда происходит исключение системы безопасности, 
В случае работы с GWT, у вас есть два способа корректно обработать исключения системы безопасности, 
  # предоставить стандартную страницу аутентификации, 
  # или самостоятельно обработать исключения в GWT. 

Gwtsecurity перехватывает запросы к приложению на уровне обращений к фрэймворку Spring Security (используя AOP), <br/>
gwtsecury определяет источник исключения, был ли это RemoteService или исключение было брошено в Spring MVC.<br/>
Если запрос пришедший во фрэймворк был предназначен RemoteService, то gwtsecurity разбирает пришедший запрос и передает его во внутренние механизмы Spring Security. <br/>
Если результатом является исключение то библиотека трансформирует исключение в [http://gwtsecurity.googlecode.com/svn/trunk/javadoc/1.0/com/gwt/ss/client/GwtSecurityException.html GwtSecurityException] которое пробрасывается на клиенсткую сторону GWT,<br/>
если же запрос был направлен не RemoteService gwtsecurity передает запрос через стандартный механизм Spring Security.


= Details =
В первую очередь, нужно добавить AOP в конфигурацию Spring ващего приложения следующим образом.<br/>
(Включение proxy-target-class значительно увеличивает скорость обработки запросов средствами AOP.)
{{{
    <aop:aspectj-autoproxy proxy-target-class="true"/>
}}}
после этого добавьте в конфигурацию бин отвечающий за трансляцию эксепшенов в стандартной модели работы Spring Security [http://gwtsecurity.googlecode.com/svn/trunk/javadoc/1.0/com/gwt/ss/GwtExceptionTranslator.html GwtExceptionTranslator].
{{{
    <beans:bean class="com.gwt.ss.GwtExceptionTranslator"/>
}}}

Gwtsecurity предлагает два типа исключений безопасности [http://gwtsecurity.googlecode.com/svn/trunk/javadoc/1.0/com/gwt/ss/client/GwtSecurityException.html GwtSecurityException].
|| [http://gwtsecurity.googlecode.com/svn/trunk/javadoc/1.0/com/gwt/ss/client/GwtAuthenticationException.html GwtAuthenticationException] || в случае если пользователь не аутентифицирован.<br>, в этом случае GWT приложение должно предоставить пользователю форсу для введение данных для аутентификации. ||
|| [http://gwtsecurity.googlecode.com/svn/trunk/javadoc/1.0/com/gwt/ss/client/GwtAccessDeniedException.html GwtAccessDeniedException] || в случае если пользователь не имеет достаточных прав для доступа к ресурсу.<br/>в этом случае, пользователь должен получить предупреждение об этом. ||

The demo app, I intent to handle security exception by gwt app itself(I also provide a stand aloe login page).
|| Gwt RPC login when user not yet authenticated||                                                                           
|| [http://gwtsecurity.googlecode.com/svn/trunk/resources/gssdemoSimpleLogin.png] ||
|| or redirect to spring login entry(jsp page) ||
|| [http://gwtsecurity.googlecode.com/svn/trunk/resources/login_jsp.png] ||


I configure spring security config as follows:<br/> 
First,I config spring's login entry url to handle non-gwt login event. 
{{{
   <form-login login-page="/login.jsp" authentication-failure-url="/login.jsp?authfailed=true"/>
}}}
Next, I construct a bean to handle gwt login event:
{{{
   <beans:bean class="com.gwt.ss.GwtUsernamePasswordAuthority">
       <beans:property name="authenticationManager" ref="authenticationManager"/>
   </beans:bean>
}}}
Finally,I need a RemoteService to process gwt login.
{{{
    GwtLoginAsync loginService = GwtLoginAsync.Util.getInstance(getLoginUrl());
    loginService.j_gwt_security_check(userName, password, new AsyncCallback<Void>() {
        @Override
        public void onFailure(Throwable caught) {
           //fail notify 
        }
        @Override                          
        public void onSuccess(Void result) {
           //success notify
        }
    }
}}}
In the same way,logout can process from gwt app.<br/>
(config success-handler-ref instead of logout-success-url instead here.)
{{{
    <logout invalidate-session="true" success-handler-ref="logoutSuccessHandler" logout-url="/j_spring_security_logout"/>
    <beans:bean id="logoutSuccessHandler" class="com.gwt.ss.GwtLogoutSuccessHandler" p:logoutSuccessUrl="/"/>
}}}
Then
{{{
    GwtLogoutAsync logoutService = GwtLogoutAsync.Util.getInstance(getLogoutUrl());
    logoutService.j_gwt_security_logout(new AsyncCallback<Void>() {
        @Override
        public void onFailure(Throwable caught) {
            //fail notify
        }                
        @Override
        public void onSuccess(Void result) {
           //success notify
        }
    }
}}}
Alternative,logout also can process from url "http://context_path/j_spring_security_logout" 

Sometimes, you may enabled "session-management"
{{{
    <session-management invalid-session-url="/login.jsp?sessionInvalid=true">
        <concurrency-control max-sessions="1" expired-url="/login.jsp?sessionExpired=true"/>
    </session-management>
}}}
Then your need to constuct a [http://gwtsecurity.googlecode.com/svn/trunk/javadoc/1.0/com/gwt/ss/GwtSessionManagement.html GwtSessionManagement] bean
to throw a [http://gwtsecurity.googlecode.com/svn/trunk/javadoc/1.0/com/gwt/ss/client/GwtAccessDeniedException.html GwtAccessDeniedException] when session is invalid.
<br/><span color="red">(Notice: previous proxy-target-class must be set to "false")</span>
{{{
    <beans:bean class="com.gwt.ss.GwtSessionManagement"/>
}}}